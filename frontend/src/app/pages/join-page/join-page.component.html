<div class="card p-4 mx-auto mt-5 mb-5" style="max-width:360px">
  <h4
    i18n="@@JOIN.JOIN_GAME"
    class="mb-3"
  >Join Game</h4>

  <!-- Error messages -->
  <div *ngIf="showError" class="alert alert-danger mb-3 position-relative">
    <button class="btn btn-secondary btn-sm position-absolute top-0 end-0 m-2" (click)="closeError()">
      âœ–
    </button>
    <div class="p-2 m-3">
      <div [ngSwitch]="errorCode">
        <p *ngSwitchCase="'GAME_NOT_FOUND'" i18n="@@ERRORS.GAME_NOT_FOUND">
          The game you're trying to join doesn't exist.
        </p>
        <p *ngSwitchCase="'GAME_FULL'"      i18n="@@ERRORS.GAME_FULL">
          This game already has two players and cannot accept more participants.
        </p>
        <p *ngSwitchCase="'SELF_PLAY'"      i18n="@@ERRORS.SELF_PLAY_NOT_ALLOWED">
          You cannot play against yourself in online mode. Please use the 'Play Locally' option from the main menu.
        </p>
        <p *ngSwitchCase="'SERVER_ERROR'"   i18n="@@ERRORS.SERVER_ERROR">
          An error occurred while connecting to the server. Please try again later.
        </p>
        <p *ngSwitchCase="'JOIN_FAILED'"    i18n="@@ERRORS.JOIN_FAILED">
          Failed to join the game. Please try again.
        </p>
        <p *ngSwitchDefault                 i18n="@@ERRORS.UNKNOWN_ERROR">
          An unknown error occurred. Please try again later.
        </p>
      </div>
      <div class="mt-2">
        <button
          *ngIf="errorCode === 'SELF_PLAY'"
          i18n="@@GO_TO_CPU_MODE"
          class="btn btn-primary btn-sm"
          (click)="goToLocalMode()"
        >Play against CPU</button>
        <button
          *ngIf="errorCode === 'GAME_FULL'"
          i18n="@@ERRORS.CREATE_NEW_GAME"
          class="btn btn-primary btn-sm"
          (click)="goToNewGame()"
        >Create New Game</button>
      </div>
    </div>
  </div>

  <!-- 1) Choose nickname -->
  <form *ngIf="step===1" #nickForm="ngForm" (ngSubmit)="onNickname()">
    <div class="mb-3">
        <label i18n="@@JOIN.NICKNAME" class="form-label">Your nickname</label>
        <input
          name="nick"
          class="form-control"
          required minlength="3"
          [(ngModel)]="nickname" #nick="ngModel"
        />

        <div *ngIf="nick.invalid && nick.touched" class="text-danger">
          {{ nick.errors?.['required'] ? "{{ 'JOIN.REQUIRED' | translate }}" : "" }}
          {{ nick.errors?.['minlength'] ? "{{ 'JOIN.MIN_LENGTH' | translate }}" : "" }}
        </div>
    </div>
    <button
      i18n="@@JOIN.NEXT"
      class="btn btn-primary"
      [disabled]="nickForm.invalid"
    >Next</button>
  </form>

  <!-- 2) Confirm Game ID and join -->
  <form *ngIf="step===2" #joinForm="ngForm" (ngSubmit)="onJoin()">
    <div class="mb-3">
      <label i18n="@@JOIN.GAME_ID" class="form-label">Game ID</label>
      <input
        name="gameId"
        class="form-control"
        [value]="gameId" readonly
      />
    </div>
    <button class="btn btn-success"><span i18n="@@JOIN.JOIN_AS">Join as </span>{{ nickname }}</button>
  </form>
</div>